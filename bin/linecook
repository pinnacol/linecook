#!/usr/bin/env ruby

require 'linecook/version'
require 'linecook/commands'
include Linecook::Commands

cmd_class = 
  case cmd = ARGV.shift
  when 'init'
    Init
  when nil, '-h', '--help'
    puts "Usage: linecook [options] COMMAND"
    exit
  else
    puts "unknown command: #{cmd.inspect}"
    exit 1
  end

parser = ConfigParser.new
parser.add cmd_class.configurations
parser.on '-h', '--help', 'print this help' do
  puts "usage: linecook [options] init #{cmd_class.desc.value}"
  puts
  puts cmd_class.desc.wrap
  puts
  puts "options:"
  puts parser.to_s
  exit
end
parser.parse ARGV

begin
  cmd_class.new(parser.config).call ARGV
rescue CommandError
  puts $!.message
  exit 1
end